%{
#include <stdio.h>
#include <stdlib.h>
int tempno = 0;
char buf[100];
void emit(const char *s){ printf("%s\n", s); }
int newtemp(){ return ++tempno; }
void yyerror(const char *s){ fprintf(stderr,"error: %s\n", s); }
int yylex(void);
%}
%union { int ival; int tmp; }
%token <ival> NUMBER
%type <tmp> expr

%left '+' '-'
%left '*' '/'

%%
input: /* empty */
     | input line
     ;
line: expr '\n'  { /* final result in $1 (temp number) */ 
                   sprintf(buf, "t%d = (result in t%d)", $1, $1); /* optional message */ }
    | '\n'
    ;
expr: NUMBER { int t = newtemp(); printf("t%d = %d\n", t, $1); $$ = t; }
    | expr '+' expr { int t = newtemp(); printf("t%d = t%d + t%d\n", t, $1, $3); $$ = t; }
    | expr '-' expr { int t = newtemp(); printf("t%d = t%d - t%d\n", t, $1, $3); $$ = t; }
    | expr '*' expr { int t = newtemp(); printf("t%d = t%d * t%d\n", t, $1, $3); $$ = t; }
    | expr '/' expr { int t = newtemp(); printf("t%d = t%d / t%d\n", t, $1, $3); $$ = t; }
    | '(' expr ')'  { $$ = $2; }
    ;
%%
int main(void){ printf("Enter expression (newline to produce TAC)\\n"); yyparse(); return 0; }
